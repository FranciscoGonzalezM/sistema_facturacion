{% extends 'core/base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Factura #{{ factura.id }}</h2>
    <p><strong>Fecha:</strong> {{ factura.fecha|date:"d/m/Y H:i" }}</p>
    <p><strong>Cliente:</strong> {{ factura.cliente.nombre|default:"Consumidor Final" }}</p>
    <p><strong>Tipo:</strong> {{ factura.get_tipo_venta_display }}</p>
    <!-- NUEVA LÃNEA: Mostrar nombre del cajero -->
    <p><strong>Cajero:</strong> {{ factura.usuario.get_full_name|default:factura.usuario.username }}</p>

    <table class="table table-bordered">
        <thead class="table-light">
            <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Subtotal</th>
                <th>IVA (15%)</th>
                <th>Total con IVA</th>
            </tr>
        </thead>
        <tbody>
            {% for detalle in detalles %}
            <tr>
                <td>{{ detalle.producto.nombre }}</td>
                <td>{{ detalle.cantidad }}</td>
                <td>${{ detalle.precio_unitario|floatformat:2 }}</td>
                <td>${{ detalle.subtotal|floatformat:2 }}</td>
                <td>
                    {% if detalle.iva %}
                        ${{ detalle.iva_monto|floatformat:2 }}
                    {% else %}
                        $0.00
                    {% endif %}
                </td>
                <td>${{ detalle.total_con_iva|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Totales generales -->
    <div class="row justify-content-end">
        <div class="col-md-4">
            <table class="table table-borderless">
                <tr>
                    <td><strong>Subtotal:</strong></td>
                    <td>${{ factura.subtotal|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td><strong>Descuento:</strong></td>
                    <td>${{ factura.descuento|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td><strong>IVA Total:</strong></td>
                    <td>${{ factura.iva_total|floatformat:2 }}</td>
                </tr>
                <tr class="border-top">
                    <td><strong>Total:</strong></td>
                    <td><strong>${{ factura.total|floatformat:2 }}</strong></td>
                </tr>
                
                <!-- Mostrar monto recibido y vuelto solo para ventas de contado -->
                {% if factura.tipo_venta == 'contado' %}
                <tr class="border-top">
                    <td><strong>Monto Recibido:</strong></td>
                    <td><strong class="text-success">${{ factura.monto_recibido|floatformat:2 }}</strong></td>
                </tr>
                <tr>
                    <td><strong>Vuelto:</strong></td>
                    <td><strong class="text-info">${{ factura.vuelto|floatformat:2 }}</strong></td>
                </tr>
                {% endif %}
                
            </table>
        </div>
    </div>


<a href="{% url 'facturas:factura_list' %}" class="btn btn-secondary mb-3">
    Volver al listado
</a>


{% endblock %}